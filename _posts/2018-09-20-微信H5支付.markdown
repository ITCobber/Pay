---
layout: post
title: 微信H5支付 - Wisli
date: 2018-09-20 15:32:24.000000000 +09:00
---

#### 微信支付：H5 移动端支付实施细节手册

##### 支付流程
    1.用户在手机浏览器上，在应用的支付页面提交支付(商城内部产生订单/支付记录)。
    2.应用请求微信的统一下单接口。
    3.微信支付系统返回跳转链接 mweb_url。
    4.应用页面重定向到微信支付返回的跳转链接。
    5.链接会调开用户的微信 App。
    6.用户在微信  App 确认并完成支付。
    7.用户被重定向到原来申请支付时的页面/或者重定向到redirect_url(谷歌浏览器里面，redirect_url无效)。
    8.页面可以引导用户查询微信支付订单状态。

---

##### 注意
    一、回调页面
        正常流程用户支付完成后会返回至发起支付的页面，如需返回至指定页面，则可以在MWEB_URL后拼接上redirect_url参数，来指定回调页面。
    如，您希望用户支付完成后跳转至https://www.wechatpay.com.cn，则可以做如下处理：
假设您通过统一下单接口获到的MWEB_URL= https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb?prepay_id=wx20161110163838f231619da20804912345&package=1037687096
则拼接后的地址为MWEB_URL= https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb?prepay_id=wx20161110163838f231619da20804912345&package=1037687096&redirect_url=https%3A%2F%2Fwww.wechatpay.com.cn
    注意：
    1.需对redirect_url进行urlencode处理
    2.由于设置redirect_url后,回跳指定页面的操作可能发生在：1,微信支付中间页调起微信收银台后超过5秒 2,用户点击“取消支付“或支付完成后点“完成”按钮。因此无法保证页面回跳时，支付流程已结束，所以商户设置的redirect_url地址不能自动执行查单操作，应让用户去点击按钮触发查单操作
二、其它常见错误
    [错误信息处理] (https://pay.weixin.qq.com/wiki/doc/api/H5_sl.php?chapter=15_4)
---
#### Usage

```bash
$ git clone https://github.com/onevcat/vno-jekyll.git your_site
$ cd your_site
$ bundler install
$ bundler exec jekyll serve
```

Your site with `Vno Jekyll` enabled should be accessible in http://127.0.0.1:4000.

For more information about Jekyll, please visit [Jekyll's site](http://jekyllrb.com).

#### Configuration

All configuration could be done in `_config.yml`. Remember you need to restart to serve the page when after changing the config file. Everything in the config file should be self-explanatory.

#### Background image and avatar

You could replace the background and avatar image in `assets/images` folder to change them.

#### Sites using Vno

[My blog](http://onevcat.com) is using `Vno Jekyll` as well, you could see how it works in real. There are some other sites using the same theme. You can find them below:

| Site Name    | URL                                                |
| ------------ | ---------------------------------------------------|
| OneV's Den   | [http://onevcat.com](http://onevcat.com)           |
| July Tang    | [http://blog.julytang.xyz](http://onevcat.com)     |
| Harry Lee    | [http://qiuqi.li](http://qiuqi.li)                 |

> If you happen to be using this theme, welcome to [send me a pull request](https://github.com/onevcat/vno-jekyll/pulls) to add your site link here. :)

#### License

Great thanks to [Dale Anthony](https://github.com/daleanthony) and his [Uno](https://github.com/daleanthony/uno). Vno Jekyll is based on Uno, and contains a lot of modification on page layout, animation, font and some more things I can not remember. Vno Jekyll is followed with Uno and be licensed as [Creative Commons Attribution 4.0 International](http://creativecommons.org/licenses/by/4.0/). See the link for more information.
